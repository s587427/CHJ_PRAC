<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="./index.js" defer></script>
    <title>LazyLoading</title>
</head>
<body>
    <!-- 
        Lazy loading 這個詞聽起來很炫炮，但其實它主要做的事情只有三件：
            不讓圖片正常載入
            監視圖片元素，判斷它們是否進入到畫面中
            元素進入畫面後，再載入圖片 
    -->
    <h1>Lazy-loaging-Example</h1>
    <div class="imgWrap">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x203">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x204">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x205">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x206">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x207">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x208">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x209">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x210">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x211">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x212">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x213">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x214">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x215">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x216">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x217">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x218">
       <img class="skeleton" data-src="https://source.unsplash.com/featured/300x219">
    </div>
</body>
</html>

<script>

    const ObserverConatiner = document.querySelector(".imgWrap")

    getData()
    .then(res =>{
        console.log(res)
        res.forEach((item, index)=>{
            fileName = item.json_file.replace(/\[|\]|"/g, "")
            let imgElement = document.createElement("img")
            imgElement.className = "skeletom"
            imgElement.setAttribute("data-src", `https://kiss66.net/kiss66/uploads/${fileName}`)
            ObserverConatiner.appendChild(imgElement)
            console.log("doing")
        })
        runObserver()
    })

    async function getData(){
        const result = await fetch("https://kiss66.net/kiss66/api/ApiGetNews")
        const dataJson = await result.json()
        return dataJson     
    }

</script>


